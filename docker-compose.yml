# version: '3.8'

services:
  auth:
    build:
      context: .
      dockerfile: Dockerfile

    container_name: auth

    ports:
      - "8070:8070"

    # 환경 변수 설정
    environment:
      DB_URL: jdbc:mysql://mysql-8:3306/seok?useSSL=false&serverTimezone=Asia/Seoul&allowPublicKeyRetrieval=true
      DB_USER: root
      DB_PASSWORD: mj38327348!
      #      DB_URL: jdbc:mysql://ls-8faa18b81878f46e9606f6423374660053940c3d.cvs88wyuub4j.ap-northeast-2.rds.amazonaws.com:3306/seok?useSSL=false&serverTimezone=Asia/Seoul&allowPublicKeyRetrieval=true
      #      DB_USER: dbmasteruser
      #      DB_PASSWORD: MedV2vOes&qfP5X8,XgZN00^b[XE(AME

      JWT_SECRET: cM3qNkRJm2soao2XXUmRPKwVsb8YYmSds0WfNIOGMYOhd7asNe63MARsuaexSUyKNeO8x3BD3b43RkLk5dTxsw==
      JWT_ACCESS_TOKEN_EXPIRATION: 600000
      JWT_REFRESH_TOKEN_EXPIRATION: 604800000

      KAKAO_CLIENT_ID: 104c0983592d86948311227bfd9c57c0
      KAKAO_CLIENT_SECRET: HQ4Fr5saQGEDANTSFB4pOndELAeGCJdL
      KAKAO_REDIRECT_URI: http://localhost:8070/api/oauth/kakao/callback

      # Spring profile 정보(개발 전용, 로컬 환경에서 테스트)
      SPRING_PROFILES_ACTIVE: ${SPRING_PROFILES_ACTIVE:-dev}

    #네트워크 설정
    networks:
      - auth-network
    #    network_mode: bridge

    # 의존성(Dependency)
    external_links:
      - mysql8

    # 재시작 정책
    restart: unless-stopped

# 기존 auth-network에 연결함
networks:
  auth-network:
    driver: bridge
    external: true

################################################################
# 1. auth container 실행하기
# 빌드하지 않고 백그라운드로 컨테이너를 바로 시작하기
# docker compose up -d

# 빌드하고 백그라운드로 컨테이너를 바로 시작하기
# docker compose up -d --build

# 2. 로그 확인하기(실시간, 종료하려면 ctrl + c)
# docker compose logs -f auth

# 3. 정지
# docker compose stop

# 4. 재시작
# docker compose restart

# 5. 삭제
# docker compose down

# 6. 빌드 후 시작하기
# docker compose up -d --build

# 7. 컨테이너 & 이미지 삭제
# docker compose down --rmi all